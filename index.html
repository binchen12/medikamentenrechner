<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Medikamenten-Rechner</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
      background-color: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 1em;
    }
    input, select {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.3em;
    }
    button {
      margin-top: 1.5em;
      padding: 0.7em;
      width: 100%;
      font-size: 1em;
    }
    #output {
      margin-top: 2em;
      padding: 1em;
      background-color: #e0f7fa;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h2>🧮 Medikamenten-Rechner</h2>

  <label>
    Zielgruppe:
    <select id="zielgruppe" onchange="aktualisiereMedikamente()">
      <option value="">-- Bitte wählen --</option>
      <option value="kind">Kind</option>
      <option value="erwachsener">Erwachsener</option>
    </select>
  </label>

  <label>
    Kategorie:
    <select id="kategorie" onchange="aktualisiereMedikamente()">
      <option value="">-- Bitte wählen --</option>
      <option value="analgosedierung">Analgosedierung</option>
      <option value="narkose">Narkose</option>
      <option value="cpr">CPR</option>
      <option value="anaphylaxie">Anaphylaxie</option>
      <option value="krampfanfall">Krampfanfall</option>
      <option value="atemnot">Atemnot</option>
      <option value="bradykardie">Bradykardie</option>
      <option value="sonstiges">Sonstiges</option>
    </select>
  </label>

  <label>
    Medikament:
    <select id="medikament" onchange="vordefinieren()">
      <option value="">-- Medikament wählen --</option>
    </select>
  </label>

  <label>
    Konzentration (mg/ml):
    <input type="number" id="konzentration" step="0.01" required>
  </label>

  <label>
    Dosierung:
    <input type="text" id="dosierung" required>
  </label>

  <label>
    Gewicht des Patienten (kg):
    <input type="number" id="gewicht" step="0.1" required>
  </label>

  <button onclick="berechne()">💊 Berechnen</button>

  <div id="output"></div>

  <script>
    const daten = {
      kind: {
        cpr: {
          adrenalin: { konzentration: 0.1, dosierung: 0.01 },
          amiodaron: { konzentration: 50, dosierung: 5 },
          "adrenalin-perfusor": { konzentration: 0.02, dosierung: 0.0001 }
        },
        anaphylaxie: {
          "adrenalin-im": { konzentration: 1, dosierung: 0.01 },
          dimetinden: { konzentration: 1, dosierung: 0.1 },
          prednisolon: { konzentration: 50, dosierung: 2 }
        },
        analgosedierung: {
          "esketamin-in": { konzentration: 25, dosierung: 2 },
          "fentanyl-in": { konzentration: 50, dosierung: 0.002 },
          "midazolam-in": { konzentration: 5, dosierung: 0.2 },
          "esketamin-iv": { konzentration: 5, dosierung: 0.5 },
          "fentanyl-iv": { konzentration: 50, dosierung: 0.001 },
          piritramid: { konzentration: 1, dosierung: 0.1 },
          "midazolam-iv": { konzentration: 1, dosierung: 0.1 }
        },
        krampfanfall: {
          "midazolam-in": { konzentration: 5, dosierung: 0.3 },
          "midazolam-iv": { konzentration: 1, dosierung: 0.1 },
          levetiracetam: { konzentration: 50, dosierung: 40 },
          lorazepam: { konzentration: 1, dosierung: 0.1 }
        },
        narkose: {
          "esketamin-iv": { konzentration: 25, dosierung: 2 },
          rocuronium: { konzentration: 10, dosierung: 1 },
          "fentanyl-iv": { konzentration: 50, dosierung: 0.003 },
          propofol: { konzentration: 10, dosierung: 4 },
          "midazolam-iv": { konzentration: 1, dosierung: 0.2 },
          "propofol-perfusor": { konzentration: 10, dosierung: 6 }
        },
        atemnot: {
          "adrenalin-inh": { konzentration: 1, dosierung: 1 },
          salbutamol: { konzentration: 0.5, dosierung: 0.0005 },
          dexamethason: { konzentration: 0.4, dosierung: 0.15 }
        },
        sonstiges: {
          ceftriaxon: { konzentration: 50, dosierung: 100 },
          glucose: { konzentration: 200, dosierung: 200 },
          adenosin: { konzentration: 3, dosierung: 0.2 },
          tranexamsaeure: { konzentration: 100, dosierung: 15 }
        },
        bradykardie: {}
      },
      erwachsener: {
        analgosedierung: {
          fentanyl: { konzentration: 0.05, dosierung: 0.001 },
          esketamin: { konzentration: 5, dosierung: 0.25 }
        },
        narkose: {},
        cpr: {},
        anaphylaxie: {},
        krampfanfall: {},
        atemnot: {},
        bradykardie: {},
        sonstiges: {}
      }
    };

    function aktualisiereMedikamente() {
      const zielgruppe = document.getElementById('zielgruppe').value;
      const kategorie = document.getElementById('kategorie').value;
      const medikamentSelect = document.getElementById('medikament');

      medikamentSelect.innerHTML = '<option value="">-- Medikament wählen --</option>';

      if (zielgruppe && kategorie && daten[zielgruppe][kategorie]) {
        const medikamente = Object.keys(daten[zielgruppe][kategorie]);
        medikamente.forEach(medikament => {
          const option = document.createElement('option');
          option.value = medikament;
          option.text = medikament;
          medikamentSelect.appendChild(option);
        });
      }
    }

    function vordefinieren() {
      const zielgruppe = document.getElementById('zielgruppe').value;
      const kategorie = document.getElementById('kategorie').value;
      const medikament = document.getElementById('medikament').value;

      if (zielgruppe && kategorie && medikament && daten[zielgruppe][kategorie][medikament]) {
        const eintrag = daten[zielgruppe][kategorie][medikament];
        document.getElementById('konzentration').value = eintrag.konzentration;

        const dosis = eintrag.dosierung;
        const dosisText = dosis < 0.01 ? `${(dosis * 1000).toFixed(1)} µg/kg` : `${dosis.toFixed(2)} mg/kg`;
        document.getElementById('dosierung').value = dosisText;
      }
    }

    function berechne() {
      const konzentration = parseFloat(document.getElementById('konzentration').value);
      const gewicht = parseFloat(document.getElementById('gewicht').value);
      let dosierungWert = document.getElementById('dosierung').value.trim();

      let dosierung;
      if (dosierungWert.includes('µg')) {
        dosierung = parseFloat(dosierungWert) / 1000;
      } else {
        dosierung = parseFloat(dosierungWert);
      }

      if (isNaN(konzentration) || isNaN(dosierung) || isNaN(gewicht)) {
        document.getElementById('output').innerHTML = "❗ Bitte alle Felder korrekt ausfüllen.";
        return;
      }

      const dosis = dosierung * gewicht;
      const volumen = dosis / konzentration;

      document.getElementById('output').innerHTML = `
        <strong>Ergebnis:</strong><br>
        Gesamtdosis: <strong>${dosis.toFixed(3)} mg</strong><br>
        Volumen der Lösung: <strong>${volumen.toFixed(2)} ml</strong>
      `;
    }
  </script>

</body>
</html>
